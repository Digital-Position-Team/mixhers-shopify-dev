{% assign ingredients = product.metafields.rebrand.rebrand_ingredients.value %}
{% assign ingredient_outer_color = product.metafields.rebrand.ingredient_outer_color.value %}
{% assign ingredient_inner_color = product.metafields.rebrand.ingredient_inner_color.value %}
{% assign stick_image_mobile = product.metafields.rebrand.stick_image_mobile.value %}
{% assign stick_image_desktop = product.metafields.rebrand.stick_image_desktop.value %}

{% assign has_ingredients = false %}
{% for ingredient in ingredients %}
    {% if ingredient %}
        {% assign has_ingredients = true %}
        {% break %}
    {% endif %}
{% endfor %}

{% assign has_clinical_studies = false %}
{% for ingredient in ingredients %}
    {% if ingredient.clinical_studies %}
        {% assign has_clinical_studies = true %}
        {% break %}
    {% endif %}
{% endfor %}

{% if has_ingredients and stick_image_mobile and stick_image_desktop %}
    <style>
        @media screen and (min-width: 768px) {
            .custom-inner-circle {
                background-color: {{ ingredient_inner_color }};
            }
        }
        .custom-section {
            background-color: {{ ingredient_outer_color }};
            padding: 2rem;
            border-radius: 50%;
        }
        .custom-heading {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        .custom-paragraph {
            font-size: 1rem;
        }
        .custom-summary {
            font-weight: bold;
            cursor: pointer;
        }
        .custom-details {
            background: #fff;
            padding: 1rem;
            border: 1px solid #ccc;
            margin-bottom: 1rem;
        }
    </style>

    <div class="custom-section">
        <div class="custom-inner-circle">
            <img
                src="{{ stick_image_mobile | image_url }}"
                alt="{{ product.title }}"
                width="300"
                height="300"
                style="display: block; margin: 0 auto;"
                class="mobile-only"
            >
            <img
                src="{{ stick_image_desktop | image_url }}"
                alt="{{ product.title }}"
                width="150"
                height="500"
                style="display: none; margin: 0 auto;"
                class="desktop-only"
            >
            <div>
                <div>
                    <h2 class="custom-heading">Formulation</h2>
                    <p class="custom-paragraph">
                        All Mixhers products are designed with women in mind. We start with thoughtfully dosed ingredients that gently nourish the body and naturally balance hormones.
                    </p>
                </div>
                <div>
                    {% if ingredients %}
                        <details open>
                            <summary class="custom-summary">Ingredients</summary>
                            <div>
                                {% for ingredient in ingredients %}
                                    <details class="custom-details">
                                        <summary class="custom-summary">{{ ingredient.name }}</summary>
                                        <p class="custom-paragraph">{{ ingredient.description }}</p>
                                    </details>
                                {% endfor %}
                            </div>
                        </details>
                    {% endif %}

                    {% if has_clinical_studies %}
                        <details>
                            <summary class="custom-summary">Clinical Studies</summary>
                            <div>
                                {% for ingredient in ingredients %}
                                    {% assign studies = ingredient.clinical_studies.value %}
                                    {% if studies %}
                                        <details class="custom-details">
                                            <summary class="custom-summary">{{ ingredient.name }}</summary>
                                            <div>
                                                {% for study in studies %}
                                                    <div>
                                                        <p><strong>{{ study.source }}</strong></p>
                                                        <p>“{{ study.title }}”</p>
                                                        <a href="{{ study.link }}">Read Journal Article →</a>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </details>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </details>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div style="border-top: 1px solid black;"></div>
{% endif %}
