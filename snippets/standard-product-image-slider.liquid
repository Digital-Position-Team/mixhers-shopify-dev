<style>
  .product-carousel-container {
    width: 100%;
    height: 450px;
    overflow: hidden;
    max-width: 100%;
    box-sizing: border-box;
    padding-bottom: 25px;
  }
  .product-carousel-container .swiper-wrapper {
    height: 100%;
  }
  .product-carousel-container .swiper-slide {
    height: 100%;
    flex-shrink: 0;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .product-carousel-container .swiper-slide img {
    width: 100%;
    height: 100%;
    max-height: 450px;
    object-fit: cover;
    object-position: center;
  }
  .product-carousel-wrapper {
    display: none;
  }
  .product-carousel-desktop {
    display: none;
  }
  .swiper-pagination {
    display: flex;
    justify-content: flex-start;
    padding-left: 16px;
    width: 100%;
  }
  .swiper-pagination-bullet-active {
    background: #1a1a1a;
  }
  .product-feature-image img {
    display: block;
    max-width: 100%;
    height: auto;
  }
  .desktop-carousel-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
    flex-wrap: nowrap;
    width: 100%;
    gap: 0px;
    position: relative;
    padding-bottom: 50px; /* Space for navigation */
  }
  
  .desktop-carousel-main,
  .desktop-carousel-thumbnail {
    flex: 1;
    position: relative;
    aspect-ratio: 1 / 1.25;
    overflow: hidden;
  }
  .desktop-carousel-main img,
  .desktop-carousel-thumbnail img,
   .swiper-slide img{
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .thumbnail-nav {
    position: absolute;
    bottom: 10px;
    right: 0;
    width: 50%;
    display: flex;
    gap: 6px;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    padding: 0 10px;
  }
  .carousel-thumbnail {
    background: none;
    border: none;
    outline: none;
    background-color: transparent;
    padding: 0px;
    margin: 0px;
    display: inline-block;
  }
  .carousel-thumbnail img {
    width: clamp(40px, 8vw, 64px);
    height: clamp(40px, 8vw, 64px);
    border-radius: 100%;
    border: 2px solid #fff;
    cursor: pointer;
    transition: border 0.3s ease;
  }
  
  /* Responsive thumbnail sizing for different counts */
  @media (min-width: 1024px) {
    .thumbnail-nav {
      gap: clamp(4px, 1vw, 8px);
    }
    
    /* Smaller thumbnails when more than 4 images */
    .thumbnail-nav:has(.carousel-thumbnail:nth-child(5)) .carousel-thumbnail img {
      width: clamp(36px, 6vw, 52px);
      height: clamp(36px, 6vw, 52px);
    }
    
    /* Even smaller when 6 images */
    .thumbnail-nav:has(.carousel-thumbnail:nth-child(6)) .carousel-thumbnail img {
      width: clamp(32px, 5vw, 48px);
      height: clamp(32px, 5vw, 48px);
    }
  }
  .carousel-thumbnail img:hover {
    border-color: #ccc;
  }

  @media (min-width: 1024px) {
    .product-carousel-wrapper {
      display: none;
    }
    .product-carousel-desktop {
      display: block;
    }
    .product-carousel-container {
      display: none;
    }
  }

  @media (max-width: 1023px) {
    .product-carousel-wrapper {
      display: block;
    }
    .product-carousel-desktop {
      display: none;
    }
  }
</style>


{% assign product_images = product.metafields.rebrand.carousel_images.value %}
{% assign featured_image = product.metafields.rebrand.featured_image.value %}

<!-- Mobile Slider -->
<div class="product-carousel-wrapper">
    <div class="swiper product-carousel-container" id="product-image-carousels">
      <div class="swiper-wrapper">
        <div class="swiper-slide">
          <img src="{{ featured_image | image_url }}" alt="{{ product.title }}" width="280" height="390">
        </div>
        {% for product_image in product_images %}
          <div class="swiper-slide">
            <img src="{{ product_image | image_url }}" alt="{{ product.title }}" width="280" height="390">
          </div>
        {% endfor %}
      </div>
      <div class="swiper-pagination"></div>
    </div>
</div>

<!-- Desktop Layout -->
<div class="product-carousel-desktop">
  <div class="desktop-carousel-wrapper">
    <div class="desktop-carousel-main">
      <img src="{{ featured_image | image_url }}" alt="{{ product.title }}" width="472" height="592">
    </div>
    <div class="desktop-carousel-thumbnail">
      <img src="{{ product_images | first | image_url }}" alt="{{ product.title }}" class="carousel-image-active" width="472" height="592">
    </div>
  </div>
  
  <div class="thumbnail-nav">
    {% for product_image in product_images %}
      <button class="carousel-thumbnail" type="button">
        <img src="{{ product_image | image_url }}" alt="{{ product.title }}"  width="" height="">
      </button>
    {% endfor %}
  </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
       // Check if it's desktop (1024px and above) to set initial slide
       const isDesktop = window.innerWidth >= 1024;
       const initialSlideIndex = isDesktop ? 1 : 0;
       
       const swiper = new Swiper('#product-image-carousels', {
          loop: false,
          spaceBetween: 0, 
          slidesPerView: 1,
          initialSlide: initialSlideIndex,
         breakpoints: {
           1024: {
            slidesPerView: 1.1
          },
          768: {
            slidesPerView: 1.1
          },
          320: {
            slidesPerView: 1.1
          }
        },
            pagination: {
              el: '.swiper-pagination',
              clickable: true,
            },
            navigation: false,
       });
     });
      
    $(document).ready(function () {
        // const swiper = new Swiper('#product-image-carousel', {
        //     spaceBetween: 0,
        //     slidesPerView: 1.2,
        //     pagination: {
        //         el: '.swiper-pagination',
        //     },
        // });
       
        $('.carousel-thumbnail').on('click', function () {
            const activeImage = $('.carousel-image-active');
            const src = $(this).find('img').attr('src');
            activeImage.attr('src', src);
        });
    });
</script>
