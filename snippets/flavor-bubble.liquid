{% for option in product.options %}
  {% assign option_handle = option | downcase %}
  {% assign selector_prefix = '' %}

  {% if option == 'Size' or option == 'Product' %}
    {% assign selector_prefix = '.product--size-select--item' %}
  {% else %}
    {% assign selector_prefix = '.select-selected' %}
  {% endif %}

  {% for variant in product.variants %}
    {% assign bubble_value = variant.metafields.custom.bubble.value %}
    {% assign size = bubble_value.size %}
    
    {% if size == 1 %}
      .{{ product.handle }} {{ selector_prefix }}[data-name="{{ variant.option1 }}"]:before,
      .{{ product.handle }} .select-items div[data-name="{{ variant.option1 }}"]:before {
        background: {{ bubble_value }};
      }
    {% elsif size == 2 %}
      .{{ product.handle }} {{ selector_prefix }}[data-name="{{ variant.option1 }}"]:before,
      .{{ product.handle }} .select-items div[data-name="{{ variant.option1 }}"]:before {
        background: linear-gradient(to right, {{ bubble_value[0] }} 50%, {{ bubble_value[1] }} 50%);
      }
    {% elsif size == 3 %}
      .{{ product.handle }} {{ selector_prefix }}[data-name="{{ variant.option1 }}"]:before,
      .{{ product.handle }} .select-items div[data-name="{{ variant.option1 }}"]:before {
        background: conic-gradient(from 60deg at center, {{ bubble_value[0] }} 0 33.3%, {{ bubble_value[1] }} 0 66.6%, {{ bubble_value[2] }} 0 99.9%);
      }
    {% endif %}
  {% endfor %}
{% endfor %}
